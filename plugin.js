penpot.ui.open("Sticky Notes Plugin",`?theme=${penpot.theme}`);penpot.on("themechange",a=>{u({type:"theme",content:a})});function u(a){penpot.ui.sendMessage(a)}penpot.ui.onMessage(async a=>{if(a.type==="create-note"){const{content:p,includeNoteAuthor:r,color:d}=a.data,{currentUser:i}=penpot,l=d??"#f0ff22",e=penpot.createBoard();e.boardX=penpot.viewport.center.x,e.boardY=penpot.viewport.center.y,e.fills=[{fillOpacity:1,fillColor:l}],e.shadows=[{style:"drop-shadow",offsetX:4,offsetY:4,blur:4,color:{color:"#000000",opacity:.2}}],e.resize(300,300),e.name="üìù from "+i.name,e.borderRadius=8;const o=e.addFlexLayout();e.flex.dir="column",e.flex.alignItems="stretch",o.dir="column",o.alignItems="start",o.justifyContent="stretch",o.verticalPadding=16,o.horizontalPadding=16,o.horizontalSizing="fill",o.alignItems="stretch";const n=penpot.createText(p);if(n.growType="auto-width",n.fontSize="18",e.appendChild(n),n.layoutChild.horizontalSizing="fill",n.layoutChild.verticalSizing="fill",r){const t=penpot.createBoard();t.name="Footer",t.fills=[{fillOpacity:0,fillColor:"#f0ff22"}];const s=t.addFlexLayout();t.flex.dir="row",t.flex.horizontalSizing="fill",e.flex.justifyContent="stretch",s.alignItems="stretch",s.dir="row",s.justifyContent="space-between",s.topPadding=8,s.horizontalPadding=16;const c=penpot.createText(i.name??"");c==null||c.resize(150,40),t.appendChild(c);const f=await penpot.uploadMediaData("avatar",g(i.avatarUrl),"image/png"),h=penpot.createRectangle();h.resize(40,40),h.fills=[{fillOpacity:1,fillImage:{...f,keepApectRatio:!0}}],t.appendChild(h),e.appendChild(t),t.layoutChild.horizontalSizing="fill",t.layoutChild.verticalSizing="auto"}}});function g(a){const p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=a.replace(/^data:image\/png;base64,/,"");let d=r.length,i=[];for(let l=0;l<d;l+=4){let e=p.indexOf(r[l]),o=p.indexOf(r[l+1]),n=p.indexOf(r[l+2]),t=p.indexOf(r[l+3]);if(isNaN(e)||isNaN(o))break;let s=e<<2|o>>4;if(i.push(s),!isNaN(n)){let c=o<<4&255|n>>2;if(i.push(c),!isNaN(t)){let f=n<<6&255|t;i.push(f)}}}return new Uint8Array(i)}
